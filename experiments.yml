builds:
  - name: networkit
    git: 'https://github.com/adsharma/networkit.git'
    regenerate:
      - args: ['git', 'submodule', 'update', '--init']
    configure:
      - args:
          - 'cmake'
          - '-DCMAKE_INSTALL_PREFIX=@THIS_PREFIX_DIR@'
          - '-DCMAKE_BUILD_TYPE=Release'
          - '-DNETWORKIT_CXX_STANDARD=20'
          - '@THIS_CLONE_DIR@'
        environ:
            'CXX': 'g++'
    compile:
      - args: ['make', '-j@PARALLELISM@']
    install:
      - args: ['make', 'install']

  - name: nwk_eval
    git: 'https://github.com/fabratu/nwk_benchmark_copy.git'
    requires:
      - networkit
    configure:
      - args:
          - 'cmake'
          - '-DCMAKE_INSTALL_PREFIX=@THIS_PREFIX_DIR@'
          - '-DCMAKE_BUILD_TYPE=Release'
          - '-DCMAKE_CXX_STANDARD=20' 
          - '@THIS_CLONE_DIR@'
        environ:
            'CXX': 'g++'
    compile:
      - args: ['make', '-j@PARALLELISM@']
    install:
      - args: ['make', 'install']
    extra_paths: ['@THIS_PREFIX_DIR@']

revisions:
  - name: comparison
    build_version:
        'networkit': 'leiden_fixes'
        'nwk_eval': 'main'

instances:
  - repo: local
    set: all
    items:
      - africa.nkb
      - asia.nkb
      - austria.nkb
      - belgium.nkb
      - flickr-growth.nkb
      - france.nkb
      - hyp-24-1.nkb
      - hyp-24-2.nkb
      - hyp-24-3.nkb
      - livejournal-links.nkb
      - rmat-b.nkb
      - rmat-er.nkb
      - rmat-g.nkb
      - soc-LiveJournal1.nkb

experiments:
  - name: python
    args: ['python', 'eval_nwk.py', '@INSTANCE@', '@EXTRA_ARGS@']
    num_nodes: 1
    procs_per_node: 1
    num_threads: 24
    stdout: out
    environ:
      OMP_NUM_THREADS: 24
  - name: cpp
    use_builds: [nwk_eval]
    args: ['nwk_eval', '@INSTANCE@', '@EXTRA_ARGS@']
    num_nodes: 1
    procs_per_node: 1
    num_threads: 24
    stdout: out
    environ:
      OMP_NUM_THREADS: 24

matrix:
  include:
    # Test operation axis on real graphs
    - experiments: [python]
      instsets: [all]
      revisions: [comparison]
    - experiments: [cpp]
      instsets: [all]
      revisions: [comparison]